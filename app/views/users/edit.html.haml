:javascript
  $(document).ready(function(){
      $('#cropbox').Jcrop({
          onChange: update_crop,
          onSelect: update_crop,
          aspectRatio: 1
      });
  });

  function update_crop(coords) {
      var rx = 100/coords.w;
      var ry = 100/coords.h;
      $('#current').hide();
      $('#preview').show();
      $('#preview').css({
          width: Math.round(rx * #{@user.avatar_geometry(:large).width}) + 'px',
          height: Math.round(ry * #{@user.avatar_geometry(:large).height}) + 'px',
          marginLeft: '-' + Math.round(rx * coords.x) + 'px',
          marginTop: '-' + Math.round(ry * coords.y) + 'px'
      });

      var ratio = #{@user.avatar_geometry(:original).width} / #{@user.avatar_geometry(:large).width};
      $("#crop_x").val(Math.round(coords.x * ratio));
      $("#crop_y").val(Math.round(coords.y * ratio));
      $("#crop_w").val(Math.round(coords.w * ratio));
      $("#crop_h").val(Math.round(coords.h * ratio));
  }

.column#left
  = render partial: 'users/profile'

  %ul.settings-menu
    %li.selected
      Account
      .chevron
    %li
      Notifications
      .chevron

  .copyright
    Copyright 2016 Prophet
    %ul.links
      %li= link_to 'About', about_path
      %li= link_to 'Help', help_path
      %li= link_to 'Terms', terms_path
      %li= link_to 'Privacy', privacy_path


.column#middle
  %h1 Account
  %h2 Change your basic account settings here

  .edit-user
    = form_for @user, html: { method: :put, multipart: true } do |f|
      %ul
        %li
          .label First Name
          = f.text_field :first_name
        %li
          .label Last Name
          = f.text_field :last_name
        %li
          .label Email
          = f.email_field :email, autofocus: true
        %li
          .label Profile Photo
          = f.file_field :avatar

        - for attribute in [:crop_x, :crop_y, :crop_w, :crop_h] do
          %li
            = f.hidden_field attribute, id: attribute

        %li#avatar-handling
          .previewing
            %h4 Preview:
            #preview-container
              = image_tag @user.avatar.url(:large), :id => "current"
              = image_tag @user.avatar.url(:original), :id => "preview"
          .cropping
            %h4 Image:
            #cropbox
              = image_tag @user.avatar.url(:original)
        %li
          .submit-tag.active Save Changes

  %h1 Password Reset
  %h2 Change your password or recover your existing one
  = form_for @user, html: { method: :put } do |f|
    = f.hidden_field :reset_password_token
    %ul
      %li
        .label New Password
        = f.password_field :password
      %li
        .label Verify Password
        = f.password_field :password_confirmation
      %li
        .label
        = link_to 'Forgot your password?', nil, tabindex: -1
      .submit-tag.active Save Changes