- hidden ||= nil
.feedback{ id: "feedback-#{feedback.id}", class: current_user.fresh_feedbacks.include?(feedback) ? 'fresh' : '', style: hidden ? 'display:none' : 'display:block' }
  .top
    .banner
      .avatar
        = image_tag feedback.author.avatar.url(:large)
      .data
        .address= address_info(feedback, current_user)
        .timestamp= "#{time_ago_in_words(feedback.created_at)} ago"
      - if feedback.author != feedback.user
        .score
          .flavor= flavor_text(feedback)
          .votes{ class: feedback.user != current_user  && current_user.is_peer?(feedback) ? 'active' : nil }
            = vote_numbers(feedback, current_user)
    .content
      = simple_format(feedback.content)
    %table.actions
      %tr
        - if current_user.is_peer?(feedback)
          %td.action.agree{ class: current_user.agrees_with(feedback) ? 'selected' : nil, 'data-action' => vote_feedback_path(feedback) }
            .icon
            .name
              Agree
        %td.action.leave-comment
          .icon
          .name
            = "Comment"
        %td.action.share
          .icon
          .name
            Share

  .commenting
    .comments
      - hidden_count = hidden_comments_count(feedback, current_user)
      - log_count = feedback.share_logs.count
      - if hidden_count > 0
        .view-all= link_to "View #{hidden_count} more comments", '', remote: true
      - feedback.comment_history.each_with_index do |comment_or_log, i|
        - if comment_or_log.is_a?(Comment)
          = render partial: 'comments/comment', locals: { comment: comment_or_log, hidden: (i - log_count < hidden_count) }
        - else
          = render partial: 'feedbacks/share_log', locals: { share_log: comment_or_log, hidden: (i - log_count < hidden_count) }

    =render partial: 'comments/form', locals: { feedback_id: feedback.id }